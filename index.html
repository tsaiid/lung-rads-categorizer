<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lung RADS</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <style>
    .lung-rads-box-header {
        padding: 5px 0 5px 0;
        background: #5bc0de;
        border-bottom: 10px solid #0099b5;
        text-align: center;
    }
    .lung-rads-box-body {
        margin-top: 10px;
        padding-left: 5px;
        padding-right: 5px;
    }
    .lung-rads-box {
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, .2);
        border: 1px solid #0099b5;
        border-bottom: 10px solid #0099b5;
        padding-left: 0 !important;
        padding-right: 0 !important;
    }
    .clickable {
        cursor: pointer;
    }
    .clickable .glyphicon {
        background: rgba(0, 0, 0, 0.15);
        display: inline-block;
        padding: 6px 12px;
        border-radius: 4px
    }
    .panel-heading span {
        margin-top: -23px;
        font-size: 15px;
        margin-right: -9px;
    }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-7">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Pulmonary Nodule</h3>
                        <span class="pull-right clickable"><button type="button" class="btn btn-sm btn-danger" id="btn_clear">Clear</button></span>

                    </div>
                    <div class="panel-body">
                        <form class="form-inline">
                            <div class="" id="specific">
                                <h5>Specific Calcification</h5>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="specific" id="" value="cp"> Complete
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="specific" id="" value="ct"> Central
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="specific" id="" value="pc"> Popcorn
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="specific" id="" value="cr"> Concentric rings
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="specific" id="" value="fc"> Fat-containing
                                </label>
                            </div>

                            <div class="" id="suspicion">
                                <h5>Suspicion of Lung Cancer</h5>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="suspicion" id="" value="sp"> Spiculation
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="suspicion" id="" value="db"> GGN that doubles in size in 1 year
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="suspicion" id="" value="ln"> Enlarged lymph nodes
                                </label>
                            </div>

                            <div class="" id="exam">
                                <h5>Exam</h5>
                                <label class="radio-inline">
                                    <input type="radio" name="exam" id="" value="b"> Baseline
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="exam" id="" value="f"> Follow-up
                                </label>
                            </div>

                            <div class="hide" id="others">
                                <h5>Follow-up</h5>
                                <label class="radio-inline">
                                    <input type="radio" name="others" id="" value="new"> New
                                </label>
                                <label class="radio-inline" id="o_growing">
                                    <input type="radio" name="others" id="" value="g" class=""> Growing
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="others" id="" value="nc"> No Change
                                </label>
                            </div>

                            <div class="" id="texture">
                                <h5>Texture</h5>
                                <label class="radio-inline">
                                    <input type="radio" name="texture" id="" value="s"> Solid
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="texture" id="part_solid" value="ps"> Part solid
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="texture" id="" value="ns"> Non-solid
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="texture" id="" value="eb"> Endobronchial
                                </label>
                            </div>


                            <h5>Size</h5>
                            <div class="input-group" id="size">
                                <span class="input-group-addon">Total</span>
                                <input type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
                                <span class="input-group-addon">mm</span>
                            </div>

                            <div class="form-group hide" id="solid_others">
                                <div class="input-group" id="solid_size">
                                    <span class="input-group-addon">Solid</span>
                                    <input type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
                                    <span class="input-group-addon">mm</span>
                                </div>
                                <label class="radio-inline">
                                    <input type="radio" name="solid_others" id="" value="new"> New
                                </label>
                                <label class="radio-inline" id="ps_growing">
                                    <input type="radio" name="solid_others" id="" value="g"> Growing
                                </label>
                            </div>
                        </form>
                    </div>
                </div>

                </form>
            </div>

            <div class="col-md-5">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-xs-offset-1 col-xs-10 lung-rads-box">
                                <div class="lung-rads-box-header">
                                    <h1 id="lung_rads">?</h1>
                                    <h5 id="lung_rads_category"><span class="badge hide" id="malignant_percentage"></span></h5>
                                    <div class="label">Lung-RADS</div>
                                </div>
                                <div class="lung-rads-box-body">
                                    <div class="panel panel-default hide" id="lung_rads_descriptor">
                                        <div class="panel-heading">
                                            <h3 class="panel-title">Descriptor</h3>
                                        </div>
                                        <div class="panel-body">
                                            <p id="lung_rads_descriptor_text"></p>
                                        </div>
                                    </div>
                                    <div class="panel panel-default hide" id="lung_rads_management">
                                        <div class="panel-heading">
                                            <h3 class="panel-title">Management</h3>
                                        </div>
                                        <div class="panel-body">
                                            <p id="lung_rads_management_text"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    lung_rads_category = [
        "Incomplete",
        "Negative",
        "Benign Appearance or Behavior",
        "Probably Benign",
        "Suspicious"
    ];

    lung_rads_descriptor = [
        "-",
        "No nodules and definitely benign nodules",
        "Nodules with a very low likelyhood of becoming a clinically active cancer due to size or lack of growth",
        "Probably benign findings - short term follow up suggested; includes nodules with a low likelihood of becoming a clinically active cancer",
        "Findings for which additional diagnostic testing and/or tissue sampling if recommended",
    ];

    lung_rads_management = {
        "0": "Additional lung cancer screening CT images and/or comparison to prior chest CT examinations is needed",
        "1": "Continue annual screening with LDCT in 12 months",
        "2": "Continue annual screening with LDCT in 12 months",
        "3": "6 month LDCT",
        "4A": "3 month LDCT; PET/CT may be used when there is a ≥ 8 mm solid component",
        "4B": "Chest CT with or without contrast, PET/CT and/or tissue sampling depending on the *probability of malignancy and comorbidities. PET/CT may be used when there is a ≥ 8 mm solid component",
        "4X": "Chest CT with or without contrast, PET/CT and/or tissue sampling depending on the *probability of malignancy and comorbidities. PET/CT may be used when there is a ≥ 8 mm solid component"
    };

    malignant_percentage = {
        "0": "n/a",
        "1": "n/a",
        "2": "< 1%",
        "3": "1–2%",
        "4A": "5–15%",
        "4B": "> 15%",
        "4X": "> 15%"
    };

    function reset_layout() {
        $('#lung_rads').text("??")
        $('#lung_rads_category').text("")
        $('input:checked').prop('checked', false);
        $('#size input, #solid_size input').val("");

        $('#others').addClass('hide');
        $('#solid_others').addClass('hide');
        $('#lung_rads_descriptor').addClass('hide');
        $('#lung_rads_management').addClass('hide');
    }


    function update_lung_rads(lung_rads) {
        lung_rads_no = parseInt(lung_rads)
        $('#lung_rads').text(lung_rads)
        if (Number.isInteger(lung_rads_no)) {
            $('#lung_rads_category').html(lung_rads_category[lung_rads_no] + ' <span class="badge hide" id="malignant_percentage">')
            $('#malignant_percentage').text(malignant_percentage[lung_rads])
            $('#lung_rads_descriptor_text').text(lung_rads_descriptor[lung_rads_no])
            $('#lung_rads_management_text').text(lung_rads_management[lung_rads])

            $('#malignant_percentage').removeClass('hide');
            $('#lung_rads_descriptor').removeClass('hide');
            $('#lung_rads_management').removeClass('hide');
        } else {
            $('#lung_rads_category').text("")
            $('#malignant_percentage').addClass('hide');
            $('#lung_rads_descriptor').addClass('hide');
            $('#lung_rads_management').addClass('hide');
        }
    }

    function calculate_rads() {
        specific = $('#specific :checked')
        size = $('#size input').val();
        solid_size = $('#solid_size input').val();
        solid_others = $('#solid_others :checked').val();
        texture = $('#texture :checked').val();
        exam = $('#exam :checked').val();
        others = $('#others :checked').val();
        has_suspicion = $('#suspicion :checked').length;
        lung_rads = ''

        if (specific.length > 0) {
            update_lung_rads("1")
        } else if (size > 0) {
            if (texture.length > 0) {
                switch (texture) {
                    case 's':
                        if ((others == 'new' && size < 4) ||
                            size < 6) {
                            lung_rads = '2';
                        } else if ((exam == 'b' && (size >= 6 && size < 8)) ||
                            (others == 'new' && (size >= 4 && size < 6))) {
                            lung_rads = '3';
                            if (has_suspicion)
                                lung_rads = '4X';
                        } else if ((others == 'new' && (size >= 6 && size < 8)) ||
                            (others == 'g' && size < 8) ||
                            (exam == 'b' && size >= 8 && size < 15)) {
                            lung_rads = '4A';
                            if (has_suspicion)
                                lung_rads = '4X';
                        } else if (size >= 15 ||
                            (others == 'new' || others == 'g' && size >= 8)) {
                            lung_rads = '4B';
                            if (has_suspicion)
                                lung_rads = '4X';
                        } else if (others == 'nc') {
                            lung_rads = '2';
                        } else {
                            lung_rads = '?! s ?!';
                        }
                        break;
                    case 'ps':
                        if ((exam == 'b' && size < 6) ||
                            (others == 'new' && size < 6)) {
                            lung_rads = '2';
                        } else if ((size >= 6 && solid_size < 6) ||
                            (size < 6 && others == 'new')) {
                            lung_rads = '3';
                            if (exam == 'f' && others == 'nc') {
                                lung_rads = '2';
                            }
                            if (has_suspicion)
                                lung_rads = '4X';
                        } else if (solid_size >= 8 ||
                            (solid_others == 'new' || solid_others == 'g' && solid_size >= 4)) {
                            lung_rads = '4B';
                            if (exam == 'f' && others == 'nc') {
                                lung_rads = '2';
                            }
                            if (has_suspicion)
                                lung_rads = '4X';
                        } else if (size >= 6 && ((solid_size >= 6 && solid_size < 8) || (solid_others == 'new' || solid_others == 'g' && solid_size < 4))) {
                            lung_rads = '4A';
                            if (exam == 'f' && others == 'nc') {
                                lung_rads = '2';
                            }
                            if (has_suspicion)
                                lung_rads = '4X';
                        } else {
                            lung_rads = '?! ps ?!';
                        }
                        if (!Number.isInteger(parseInt(lung_rads))) {
                            lung_rads = '?! ps ?!';
                        }
                        break;
                    case 'ns':
                        if (size < 20 ||
                            (size >= 20 && others == 'nc')) {
                            lung_rads = '2';
                        } else if ((exam == 'b' || others == 'new') && size >= 20) {
                            lung_rads = '3';
                            if (has_suspicion)
                                lung_rads = '4X';
                        } else if ((others == 'g' || has_suspicion) && size >= 20) {
                            lung_rads = '4X';
                        } else {
                            lung_rads = '?! ns ?!';
                        }
                        break;
                    case 'eb':
                        lung_rads = '4A';
                        break;
                    default:
                        lung_rads = '?! texture ?!';
                }

                // update innertext
                update_lung_rads(lung_rads)
            }
        } else {

        }
    }

    $('#texture input').change(
        function() {
            if ($('#texture :checked').val() == 'ps') {
                $('#solid_others').removeClass('hide');
            } else {
                $('#solid_others').addClass('hide');
            }
        }
    );

    $('#exam input').change(
        function() {
            if ($('#exam :checked').val() == 'f') {
                $('#others').removeClass('hide');
            } else {
                $('#others').addClass('hide');
            }
        }
    );

    $('#solid_size input').change(
        function() {
            if ($(this).val().length == 0) {
                $('#solid_others input').prop('checked', false);
            }
        }
    );

    $('#size input').change(
        function() {
            calculate_rads();
        }
    );

    $('input').change(
        function() {
            //alert('changed');
            calculate_rads();
        }
    );

    $('#btn_clear').click(
        function() {
            reset_layout();
        }
    );

    $('#ps_growing').tooltip({
        'trigger':'hover',
        'title': 'an increase in size of > 1.5 mm',
        'container': '#solid_others'
    });
    $('#o_growing').tooltip({
        'trigger':'hover',
        'title': 'an increase in size of > 1.5 mm',
        'container': '#others'
    });
    </script>
</body>

</html>
